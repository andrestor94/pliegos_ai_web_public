/* ===================== app.theme.css =====================
Ubicación sugerida: /backend/static/css/app.theme.css  (o /static/css/app.theme.css)
En base.html:
<link rel="stylesheet" href="{{ url_for('static', path='css/app.theme.css') }}">
========================================================= */

/* ---------- Design tokens (Brand Suizo) ---------- */
:root{
  /* Marca */
  --brand-500:#04436a; /* Azul oscuro (principal) */
  --brand-600:#033858; /* hover/active */
  --brand-700:#022b44; /* pressed */
  --brand-300:#5274ce; /* Azul alternativo (acentos/links) */
  --brand-100:#e7ecfa; /* tinte suave para fondos sutiles */
  --brand-white:#ffffff;

  /* Neutrales afinados a fondo cálido */
  --bg:#eeede8;              /* Fondo amarillo pálido (APP) */
  --surface:#ffffff;          /* Cards/sheets */
  --muted:#f2f1ed;            /* Paneles/inputs */

  /* === LEGIBILIDAD MEJORADA === */
  --text:#0c2535;            /* Texto principal (más oscuro) */
  --text-2:#2e4152;          /* Secundario (alto contraste) */
  --border:#d9ddd8;          /* Bordes suaves */

  /* Accesibilidad inputs/placeholder */
  --input-bg:#ffffff;
  --input-text:var(--text);
  --input-placeholder:#415566;        /* +legible */
  --input-border:var(--border);
  --input-border-focus:#5274ce;
  --input-shadow-focus:0 0 0 .25rem rgba(82,116,206,.25);

  /* Chips/Badges */
  --chip-bg: #e7ecfa;
  --chip-text: #233a80;

  /* Iconos */
  --icon:#3d4e5c;            /* +legible en claro */

  /* Pasteles (opcional) */
  --mint-200:#e4f5ee; --sky-200:#e7ecfa; --peach-200:#fff2e8; --violet-200:#f2f0ff;

  /* Sombras / radios */
  --radius:18px; --radius-lg:22px;
  --shadow-lg: 0 16px 40px rgba(8,30,61,.12);
  --shadow-md: 0 10px 24px rgba(8,30,61,.10);
  --shadow-sm: 0 6px 16px rgba(8,30,61,.08);

  /* Bootstrap overrides */
  --bs-primary: var(--brand-500);
  --bs-secondary: var(--brand-300);
  --bs-body-bg: var(--bg);
  --bs-body-color: var(--text);
  --bs-border-color: var(--border);
  --bs-link-color: var(--brand-300);
  --bs-link-hover-color: #3e5fb3;

  /* Layout helpers */
  --header-h: 76px;
  --container-max: 1240px;

  /* Safe areas (iOS notch) */
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);

  /* Rings (para box-shadow rgba) */
  --ring-color: 82,116,206; /* rgb de #5274ce */

  /* Sidebar spacing (nuevo) */
  --sidebar-gap: 10px;
}

/* ---------- Dark theme ---------- */
html[data-theme="dark"]{
  --bg:#0F141A;
  --surface:#151B22;
  --muted:#1B232C;

  /* === LEGIBILIDAD MEJORADA (DARK) === */
  --text:#ECF2F8;            /* texto principal claro */
  --text-2:#C5D0DC;          /* secundario legible (contraste >4.5:1) */
  --border:#263140;

  /* elevar brillo de marca en dark para contraste */
  --brand-100:#0E1C2A;
  --bs-link-color:#9cc7ff;
  --bs-link-hover-color:#b9d6ff;

  /* Inputs/placeholder */
  --input-bg:#151B22;
  --input-text:var(--text);
  --input-placeholder:#C5D0DC; /* +legible */
  --input-border:#263140;
  --input-border-focus:#5b76b4;
  --input-shadow-focus:0 0 0 .25rem rgba(90,134,255,.30);

  /* Chips/Badges */
  --chip-bg:#17223e;
  --chip-text:#c7d3ff;

  /* Iconos */
  --icon:#D0DAE6;            /* +legible en oscuro */

  --shadow-lg: 0 16px 40px rgba(0,0,0,.45);
  --shadow-md: 0 10px 24px rgba(0,0,0,.40);
  --shadow-sm: 0 6px 16px rgba(0,0,0,.35);
}

/* ---------- Base ---------- */
html,body{height:100%;}
html,body{ overflow-x:hidden; } /* evita desbordes en móvil */
body{
  background:var(--bg);
  color:var(--text);
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
img, video, canvas, iframe{ max-width:100%; height:auto; }

/* Enlaces */
a{ color: var(--bs-link-color); text-decoration: none; }
a:hover{ color: var(--bs-link-hover-color); text-decoration: underline; }

/* ---------- Topbar (sticky) ---------- */
.app-topbar{
  position:fixed; top:0; left:0; right:0; z-index:1030;
  background: var(--surface);
  border-bottom:1px solid var(--border);
  box-shadow: 0 2px 10px rgba(8,30,61,.04);
}
.app-topbar .navbar-brand{font-weight:700; letter-spacing:.2px; color: var(--brand-500); }

/* === LEGIBILIDAD: nav/topbar sin opacidades bajas === */
.app-topbar .nav-link, .app-topbar .navbar-text{
  color:var(--text) !important;
  opacity:1 !important;
}

.app-topbar .btn-chat{ border-radius: 999px; padding:.5rem 1rem; font-weight:600; }
.app-topbar.brand{ background: var(--brand-500); border-bottom-color: transparent; }
.app-topbar.brand .navbar-brand,
.app-topbar.brand .nav-link,
.app-topbar.brand .navbar-text{ color:#fff !important; opacity:1 !important; }
.app-topbar.brand .nav-link:hover{ color:#ffffff !important; }

@media (max-width: 575.98px){
  .app-topbar .navbar-text{ display:none; }
}

/* ---------- Layout ---------- */
.app-main{ padding-top: var(--header-h); }
.container-xxl{ max-width: var(--container-max); }
@media (max-width: 575.98px){
  .container-xxl{ max-width:100% !important; padding-left:12px; padding-right:12px; }
}

/* ---------- Cards ---------- */
.card-clean{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow-sm);
}
.card-clean .card-header{ background:linear-gradient(180deg, rgba(4,67,106,.06), rgba(4,67,106,0)); border-bottom:1px solid var(--border); }
.card-clean .card-body{ padding:1rem 1.25rem; }

/* NUEVO: contenedor base usado en el panel (index.html) */
.cardx{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow-sm);
  padding:1rem 1.25rem;
}
.cardx .title{ font-weight:800; color:var(--brand-700); }
html[data-theme="dark"] .cardx .title{ color:#e8f0ff; }

/* ---------- Segmented control ---------- */
.segmented{ display:inline-flex; background:var(--muted); border-radius:999px; padding:4px; gap:4px; border:1px solid var(--border); }
.segmented .btn{ border-radius:999px; font-weight:600; }
.segmented .btn.active{ background:var(--surface); box-shadow:var(--shadow-sm); }

/* ---------- Menú offcanvas (Bootstrap) ---------- */
.offcanvas-start{ border-right:1px solid var(--border); background:var(--surface); }
.app-menu a{ color:var(--text-2); border-radius:12px; }
.app-menu a.active,.app-menu a:hover{ background:var(--muted); color:var(--text); }

@media (max-width: 575.98px){
  .offcanvas-start{ width: 88vw; max-width: 420px; }
}
@media (min-width: 576px) and (max-width: 991.98px){
  .offcanvas-start{ width: 360px; }
}

/* ---------- Inputs ---------- */
.form-control, .form-select{
  border-radius:12px;
  border-color:var(--input-border);
  background:var(--input-bg);
  color:var(--input-text);
}
.form-control::placeholder, .form-select::placeholder{
  color:var(--input-placeholder) !important;
  opacity:1 !important;            /* fuerza contraste */
}
.form-control:focus, .form-select:focus{
  box-shadow:var(--input-shadow-focus);
  border-color:var(--input-border-focus);
}

/* Tamaño compacto útil en móvil */
.input-compact .form-control,
.input-compact .form-select{ padding:.45rem .6rem; font-size:.95rem; }

/* ---------- Botones ---------- */
.btn-primary{
  --bs-btn-bg: var(--brand-500);
  --bs-btn-border-color: var(--brand-500);
  --bs-btn-hover-bg: var(--brand-600);
  --bs-btn-hover-border-color: var(--brand-600);
  --bs-btn-active-bg: var(--brand-700);
  --bs-btn-active-border-color: var(--brand-700);
  --bs-btn-color: #ffffff;
}
.btn-secondary{
  --bs-btn-bg: var(--brand-300);
  --bs-btn-border-color: var(--brand-300);
  --bs-btn-hover-bg: #3e5fb3;
  --bs-btn-hover-border-color: #3e5fb3;
  --bs-btn-color: #ffffff;
}
.btn-outline-primary{ color: var(--brand-500); border-color: var(--brand-500); }
.btn-outline-primary:hover{ color:#fff; background: var(--brand-500); border-color: var(--brand-500); }
.btn-outline-secondary{ color: var(--brand-300); border-color: var(--brand-300); }
.btn-outline-secondary:hover{ color:#fff; background: var(--brand-300); border-color: var(--brand-300); }

/* ---------- Badges / Chips ---------- */
.badge, .chip{
  background:var(--chip-bg);
  color:var(--chip-text);
  border:1px solid var(--border);
  border-radius:999px;
  font-weight:700; /* +legible */
}

/* ---------- Iconos ---------- */
.icon, .icon-btn svg{ color:var(--icon); fill:currentColor; stroke:currentColor; }
.icon-btn{ background:transparent; border:1px solid var(--border); border-radius:10px; }
.icon-btn:hover{ background:var(--muted); }

/* ---------- Tablas ---------- */
.table-wrap{ width:100%; overflow-x:auto; -webkit-overflow-scrolling: touch; }
.table-wrap > .table{ width:100%; white-space:nowrap; margin-bottom:0; }
.table thead{ background:var(--muted); }
.table thead th, .table thead td{ color:var(--text) !important; opacity:1 !important; }
html[data-theme="dark"] .table thead{ background:#0f172a; }

/* ---------- AI widget ---------- */
.ai-widget{
  position:fixed; right:24px; bottom:88px;
  width:360px; max-width:86vw; height:520px;
  background:var(--surface); border:1px solid var(--border);
  border-radius:18px; box-shadow:var(--shadow-lg); overflow:hidden;
  transform:translateY(16px); opacity:0; pointer-events:none;
  transition: all .2s cubic-bezier(0.22,1,0.36,1);
  z-index: 1040;
}
.ai-widget.open{ transform:translateY(0); opacity:1; pointer-events:auto; }
.ai-widget .ai-header{ display:flex; align-items:center; justify-content:space-between; padding:.5rem .75rem; border-bottom:1px solid var(--border); }
.ai-widget .ai-body{ height:100%; background:var(--bg); }

@media (max-width: 575.98px){
  .ai-widget{ right:12px; left:12px; width:auto; height: 70vh; bottom: 16px; }
}

/* ---------- FAB ---------- */
.fab{
  position:fixed; right:24px; bottom:24px; z-index:1030;
  border-radius:999px; padding:.875rem 1rem; font-weight:700;
  box-shadow:var(--shadow-lg);
}
@media (max-width: 575.98px){
  .fab{ right:16px; bottom:16px; }
}

/* ---------- FullCalendar overrides ---------- */
.fc .fc-toolbar-title{ font-size:1.4rem; font-weight:700; color:var(--text); }
.fc .fc-daygrid-day-number{ font-weight:600; color:var(--text-2); }
.fc .fc-daygrid-day-frame{ background:var(--surface); }
.fc-theme-standard .fc-scrollgrid{ border:1px solid var(--border); border-radius:16px; overflow:hidden; }
.fc .fc-col-header-cell{ background:var(--muted); }
.fc .fc-button{ border-radius:999px; border-color:var(--border); background:var(--surface); color:var(--text); }
.fc .fc-button-primary:not(:disabled).fc-button-active{ background:var(--brand-500); border-color:var(--brand-500); }

/* NUEVO: mini-calendario compacto reutilizable */
.calendar-compact{ min-height:360px; }
.calendar-compact .fc .fc-view-harness{ min-height:420px !important; }
.calendar-card .segmented .btn.active{ background:var(--pill); border-color:var(--brand-300); color:var(--brand-300); }

/* ---------- Utilities ---------- */
.hero-title{
  font-size:clamp(1.6rem, 1.2rem + 1.2vw, 2rem);
  font-weight:800; color:var(--brand-700);
}
.subtle{ color:var(--text-2); }
.help-text{ color:var(--text-2); font-size:.925rem; }
.shadow-hover{ transition: box-shadow .18s cubic-bezier(0.22,1,0.36,1), transform .18s; }
.shadow-hover:hover{ box-shadow:var(--shadow-md); transform: translateY(-2px); }
.w-110{ width:110px; } /* NUEVO: usado por selector "por página" */

/* Utilidades de marca */
.text-brand{ color: var(--brand-500) !important; }
.text-brand-alt{ color: var(--brand-300) !important; }
.bg-brand{ background: var(--brand-500) !important; color:#fff !important; }
.bg-brand-alt{ background: var(--brand-300) !important; color:#fff !important; }
.bg-brand-soft{ background: rgba(4,67,106,.06) !important; }
.border-brand{ border-color: var(--brand-500) !important; }

/* ---------- Responsive helpers ---------- */
.stack{ display:grid; gap: .75rem; }
@media (min-width: 768px){
  .cols-md-2{ display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
}
@media (min-width: 992px){
  .cols-lg-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:1rem; }
  .split{ display:grid; grid-template-columns: 1.2fr .8fr; gap:1rem; }
}

/* Zonas arrastrar/soltar */
.dropzone{
  border: 2px dashed var(--border); background: var(--muted);
  padding: 1rem; border-radius: var(--radius); text-align:center;
}

/* Alturas útiles */
.h-pane-50{ height: 50vh; overflow:auto; }
.h-pane-55{ height: 55vh; overflow:auto; }
.h-pane-60{ height: 60vh; overflow:auto; }
.h-100dvh{ height: 100dvh; }

/* ---------- Sticky helpers ---------- */
.sticky-topbar{ position: sticky; top: 0; z-index: 10; background: var(--surface); border-bottom: 1px solid var(--border); }
.sticky-footer{ position: sticky; bottom:  0; z-index: 5; background: var(--surface); border-top: 1px solid var(--border); }

/* ---------- MOBILE FIXES EXTRA ---------- */
@media (max-width: 575.98px){
  .row > [class*="col-"]{
    flex: 0 0 100% !important;
    max-width: 100% !important;
  }
  .btn, .btn-chat{ padding:.5rem .9rem; }
  .card, .card-clean, .brand, .pill, .icon-btn{ max-width:100%; }
}
[class*="container"], [class*="Container"]{ min-width: 0; }

/* ---------- Reduced motion ---------- */
@media (prefers-reduced-motion: reduce){
  *{ transition:none !important; animation:none !important; }
}

/* =========================================================
   ===== LEGIBILIDAD GLOBAL EXTENDIDA (descripciones) ======
   ========================================================= */
.text-muted,
.text-body-secondary,
.text-secondary,
.form-text,
small{
  color: var(--text-2) !important;
  opacity: 1 !important;
}
label,
.legend,
.caption{
  color: var(--text) !important;
}
input::placeholder,
textarea::placeholder{
  color: var(--input-placeholder) !important;
  opacity: 1 !important;
}

/* =========================================================
   ===== FIXS DE CONTRASTE EN ÁREAS DE CONTENIDO ===========
   ========================================================= */
.content .text-white-50,
.content .text-white-75,
.content .opacity-25,
.content .opacity-50,
.content .opacity-75{
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* =========================================================
   ===== COMPONENTES COMUNES: cards, modales, etc. =========
   ========================================================= */
.card, .card-clean, .cardx,
.modal-content,
.offcanvas,
.dropdown-menu,
.list-group-item,
.accordion-body,
.toast, .toast-body,
.chat-ia, .chat-ia__body{ }
.card *, .card-clean *, .cardx *,
.modal-content * ,
.offcanvas * ,
.dropdown-menu * ,
.list-group-item * ,
.accordion-body * ,
.toast *, .toast-body * ,
.chat-ia *, .chat-ia__body * { }

/* Fuerza contraste en clases “claras” habituales dentro de contenedores */
.card .text-white-50, .card-clean .text-white-50, .cardx .text-white-50,
.modal-content .text-white-50,
.offcanvas .text-white-50,
.dropdown-menu .text-white-50,
.list-group-item .text-white-50,
.accordion-body .text-white-50,
.toast .text-white-50, .toast-body .text-white-50,
.chat-ia .text-white-50, .chat-ia__body .text-white-50,
.card .text-white-75, .card-clean .text-white-75, .cardx .text-white-75,
.modal-content .text-white-75,
.offcanvas .text-white-75,
.dropdown-menu .text-white-75,
.list-group-item .text-white-75,
.accordion-body .text-white-75,
.toast .text-white-75, .toast-body .text-white-75,
.chat-ia .text-white-75, .chat-ia__body .text-white-75,
.card .opacity-25, .card-clean .opacity-25, .cardx .opacity-25,
.modal-content .opacity-25,
.offcanvas .opacity-25,
.dropdown-menu .opacity-25,
.list-group-item .opacity-25,
.accordion-body .opacity-25,
.toast .opacity-25, .toast-body .opacity-25,
.chat-ia .opacity-25, .chat-ia__body .opacity-25,
.card .opacity-50, .card-clean .opacity-50, .cardx .opacity-50,
.modal-content .opacity-50,
.offcanvas .opacity-50,
.dropdown-menu .opacity-50,
.list-group-item .opacity-50,
.accordion-body .opacity-50,
.toast .opacity-50, .toast-body .opacity-50,
.chat-ia .opacity-50, .chat-ia__body .opacity-50,
.card .opacity-75, .card-clean .opacity-75, .cardx .opacity-75,
.modal-content .opacity-75,
.offcanvas .opacity-75,
.dropdown-menu .opacity-75,
.list-group-item .opacity-75,
.accordion-body .opacity-75,
.toast .opacity-75, .toast-body .opacity-75,
.chat-ia .opacity-75, .chat-ia__body .opacity-75{
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* =========================================================
   ===== FIXS DE CONTRASTE GENERALES EN CONTENIDO ==========
   ========================================================= */
.content .text-muted,
.content .form-text,
.content small,
.content .text-white-50,
.content .text-white-75,
.content .opacity-25,
.content .opacity-50,
.content .opacity-75{
  color: var(--text-2) !important;
  opacity: 1 !important;
}
.content input::placeholder,
.content textarea::placeholder{
  color: var(--input-placeholder) !important;
  opacity: 1 !important;
}

/* =========================================================
   ===== FIX DE CONTRASTE PARA EL CHAT INTERNO (/chat) =====
   ========================================================= */
body[data-route^="/chat"] .text-white,
body[data-route^="/chat"] .text-light{
  color: var(--text) !important;
}
body[data-route^="/chat"] .chat-header,
body[data-route^="/chat"] .chat-header * ,
body[data-route^="/chat"] .chat-body,
body[data-route^="/chat"] .chat-body * ,
body[data-route^="/chat"] .conversations,
body[data-route^="/chat"] .conversations * ,
body[data-route^="/chat"] .empty-state,
body[data-route^="/chat"] .empty-state * {
  color: var(--text);
}
body[data-route^="/chat"] .msg,
body[data-route^="/chat"] .msg *{
  color: var(--text);
}
body[data-route^="/chat"] input,
body[data-route^="/chat"] textarea,
body[data-route^="/chat"] .form-control{
  color: var(--input-text);
  background: var(--input-bg);
  border-color: var(--input-border);
}
body[data-route^="/chat"] input::placeholder,
body[data-route^="/chat"] textarea::placeholder,
body[data-route^="/chat"] .form-control::placeholder{
  color: var(--input-placeholder) !important;
  opacity: 1 !important;
}
body[data-route^="/chat"] .opacity-25,
body[data-route^="/chat"] .opacity-50,
body[data-route^="/chat"] .opacity-75,
body[data-route^="/chat"] .text-white-50,
body[data-route^="/chat"] .text-white-75{
  color: var(--text-2) !important;
  opacity: 1 !important;
}
body[data-route^="/chat"] .conversations small,
body[data-route^="/chat"] .conversations .small,
body[data-route^="/chat"] .conversations .text-muted,
body[data-route^="/chat"] .conversations .text-white-50,
body[data-route^="/chat"] .conversations .text-white-75,
body[data-route^="/chat"] .conversations .opacity-50,
body[data-route^="/chat"] .conversations .opacity-75,
body[data-route^="/chat"] .conversations [class*="text-white"],
body[data-route^="/chat"] .conversations [class*="opacity-"]{
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* =========================================================
   ===== PÁGINA DE INCIDENCIAS (/incidencias) ==============
   ========================================================= */
body[data-route^="/incidencias"] .text-muted,
body[data-route^="/incidencias"] .form-text,
body[data-route^="/incidencias"] small,
body[data-route^="/incidencias"] .opacity-50,
body[data-route^="/incidencias"] .opacity-75{
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* =========================================================
   ===== LOGIN: legibilidad del pie y ayudas ===============
   ========================================================= */
body[data-auth="1"] .content small,
body[data-auth="1"] .content .form-text{
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* =========================================================
   ===== SIDEBAR: separación de botones inferiores =========
   ========================================================= */
.sidebar .side-bottom{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:var(--sidebar-gap);
  width:100%;
  margin-top:var(--sidebar-gap);
  padding-bottom:calc(8px + var(--safe-bottom));
}
.sidebar > a.side-btn + a.side-btn{ margin-top:var(--sidebar-gap); }
.sidebar > .side-small{ margin-top:var(--sidebar-gap); }
.sidebar{ padding-bottom:calc(8px + var(--safe-bottom)); }

/* =========================================================
   ======= SAFE GUARDS: overlays y clicabilidad ============
   ========================================================= */
#chatIaOverlay,
.sidebar-overlay{
  position: fixed;
  inset: 0;
  opacity: 0;
  pointer-events: none !important;
  background: transparent;
  backdrop-filter: none;
  transition: opacity .2s ease;
  z-index: 1010;
}
#chatIaOverlay.open,
.sidebar-overlay.open{
  opacity: 1;
  pointer-events: auto !important;
  background: rgba(15,18,34,.35);
  backdrop-filter: blur(2px);
}
.chat-ia{ z-index: 1201; }
#chatIaOverlay{ z-index: 1200; }
button, .btn, [role="button"], a.btn { pointer-events: auto !important; }

/* =========================================================
   ======== REFUERZO GLOBAL DE LEGIBILIDAD (extra) =========
   ========================================================= */

/* Un poco más de contraste en secundarios */
:root{ --text-2:#2b3e4f; } /* oscurece levemente */

/* Utilidades que “lavan” texto: forzamos legibilidad SOLO en elementos de texto */
:where(p,span,small,div,em,strong,li,td,th,a,label).opacity-25:not(.disabled):not([disabled]):not([aria-disabled="true"]),
:where(p,span,small,div,em,strong,li,td,th,a,label).opacity-50:not(.disabled):not([disabled]):not([aria-disabled="true"]),
:where(p,span,small,div,em,strong,li,td,th,a,label).opacity-75:not(.disabled):not([disabled]):not([aria-disabled="true"]),
.text-white-50, .text-white-75,
.text-muted, .text-body-secondary, .text-secondary{
  opacity:1 !important;
  color:var(--text-2) !important;
}

/* Mensajes de ayuda / vacíos / notas y metadatos comunes */
:where(.help-text,.hint,.helper,.note,.caption,.subtle,
       .empty,.empty-state,.placeholder,
       .meta,.meta *, .user-meta, .session-meta,
       .user-email, .email, .no-results, .no-more){
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* Contadores como “0/4000”, “x mostradas”, etc. */
:where(.char-count,.counter,.chars,.count,.small-count){
  color: var(--text-2) !important;
  opacity: 1 !important;
  font-weight:600;
}

/* Chat (incluye chat interno y rutas que contengan “chat”) */
body[data-route*="chat"] .conversations *,
body[data-route*="chat"] .chat-body *,
body[data-route*="chat"] .chat-header *,
body[data-route*="chat"] .composer *,
body[data-route*="chat"] .hint,
body[data-route*="chat"] .empty-state{
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* Incidencias: hints bajo textarea, chip de título lateral, contadores */
body[data-route*="incidencia"] :is(.form-text, small, .hint, .helper, .counter, .caption){
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* Usuarios conectados: email y panel derecho con meta/UA/IP */
body[data-route*="usuario"] :is(.user-email,.email,.meta,.user-meta,.session-meta, .ua, .ip, .info){
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* Notificaciones: vacíos/footers tipo “No hay más resultados” */
body[data-route*="notif"] :is(.empty,.empty-state,.no-results,.no-more, .list-footer, .footer-note){
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* Mantener apariencia realmente deshabilitada */
:where(button[disabled], .btn:disabled, .disabled, [aria-disabled="true"]).opacity-50{
  opacity:.5 !important;
}

/* =========================================================
   ======== NEUTRALIZADOR DE TOKENS POR RUTA (clave) =======
   == Evita que CSS de otras vistas pise :root y lave texto ==
   ========================================================= */

/* Chat interno */
body[data-route^="/chat"]{
  /* forzamos tokens de texto y su alias --ink usados por el CSS de /chat */
  --text:#0c2535;
  --ink:#0c2535;
  --text-2:#2b3e4f;
  --input-placeholder:#415566;
  --icon:#3d4e5c;
}
html[data-theme="dark"] body[data-route^="/chat"]{
  --text:#ECF2F8;
  --ink:#ECF2F8;
  --text-2:#C5D0DC;
  --input-placeholder:#C5D0DC;
  --icon:#D0DAE6;
}

/* Usuarios conectados / presencia */
body[data-route*="usuarios"],
body[data-route*="presence"],
body[data-route*="presencia"]{
  --text:#0c2535;
  --ink:#0c2535;
  --text-2:#2b3e4f;
  --input-placeholder:#415566;
  --icon:#3d4e5c;
}
html[data-theme="dark"] body[data-route*="usuarios"],
html[data-theme="dark"] body[data-route*="presence"],
html[data-theme="dark"] body[data-route*="presencia"]{
  --text:#ECF2F8;
  --ink:#ECF2F8;
  --text-2:#C5D0DC;
  --input-placeholder:#C5D0DC;
  --icon:#D0DAE6;
}

/* Refuerzo final en /chat y /usuarios por si quedan utilidades con opacidad */
body[data-route^="/chat"] :is(.conversations, .chat-body, .chat-header, .composer, .msg, .empty-state, .hint, .small, small, .text-muted, .text-secondary, .text-white-50, .opacity-25, .opacity-50, .opacity-75),
body[data-route*="usuarios"] :is(.list-group-item, .card, .user-email, .email, .ua, .ip, .meta, .session-meta, .small, small, .text-muted, .text-secondary, .text-white-50, .opacity-25, .opacity-50, .opacity-75){
  color: var(--text-2) !important;
  opacity: 1 !important;
}

/* =========================================================
   ======== LEGIBILIDAD EXTRA v4 — Ajuste fino final =======
   ========================================================= */

/* CHAT INTERNO: el mensaje central de vacío y subtítulos van con texto principal */
body[data-route*="chat"] :is(.empty-state,.empty,.lead,.subtitle){
  color: var(--text) !important;
  opacity: 1 !important;
  font-weight: 600;
}
/* neutraliza opacidades en cualquier contenedor dentro de /chat */
body[data-route*="chat"] :is(.opacity-25,.opacity-50,.opacity-75){
  opacity: 1 !important;
}

/* USUARIOS CONECTADOS: elimina opacidades de contenedores y fuerza contraste en metadatos */
body[data-route*="usuario"] :is(.opacity-25,.opacity-50,.opacity-75),
body[data-route*="user"] :is(.opacity-25,.opacity-50,.opacity-75),
body[data-route*="presencia"] :is(.opacity-25,.opacity-50,.opacity-75),
body[data-route*="presence"] :is(.opacity-25,.opacity-50,.opacity-75){
  opacity: 1 !important;
}
/* bloques de meta a la derecha (clases sueltas o compuestas) */
body[data-route*="usuario"] :is([class*="meta"],[class*="session"],[class*="ua"],[class*="ip"],[class*="right"],[class*="trail"],[class*="detail"]),
body[data-route*="user"]     :is([class*="meta"],[class*="session"],[class*="ua"],[class*="ip"],[class*="right"],[class*="trail"],[class*="detail"]),
body[data-route*="presencia"]:is([class*="meta"],[class*="session"],[class*="ua"],[class*="ip"],[class*="right"],[class*="trail"],[class*="detail"]),
body[data-route*="presence"] :is([class*="meta"],[class*="session"],[class*="ua"],[class*="ip"],[class*="right"],[class*="trail"],[class*="detail"]){
  color: var(--text-2) !important;
  opacity: 1 !important;
  font-weight: 600;
}

/* =========================================================
   ======== HISTORIAL: paginación & estados (NUEVO) ========
   ========================================================= */
.hist-toolbar{ gap:.5rem; flex-wrap:wrap; }
.hist-meta{ font-size:.9rem; color:var(--text-2); }
.hist-empty{ color: var(--text-2); padding: 10px 0; }
.hist-item{ border:1px solid var(--border); border-radius:16px; background:var(--surface); }
.hist-pager .btn{ min-width:36px; }
.hist-pager .btn[disabled]{ pointer-events:none; opacity:.6; }

/* spinner pequeño accesible */
.spinner-sm{
  width: 1.25rem; height:1.25rem;
  border:.2rem solid #ddd;
  border-top-color: rgba(var(--ring-color), 1);
  border-radius:50%;
  animation: spin .8s linear infinite;
  display:inline-block; vertical-align:middle;
}
@keyframes spin { to { transform: rotate(360deg); } }
