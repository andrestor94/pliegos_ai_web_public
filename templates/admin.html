<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Panel de Administraci√≥n</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root {
      --color-azul: #044369;
      --color-azul-sec: #0d6efd;
      --color-gris: #eceff4;
      --color-gris-medio: #c8d0df;
      --color-gris-oscuro: #354151;
      --color-verde: #1b7b5a;
      --color-rojo: #c62828;
    }
    body { background: #f0f4ff; }
    .container { max-width: 1000px; margin-top: 40px; }
    .card { border-radius: 18px; border: none; box-shadow: 0 4px 24px rgba(4,67,105,0.09);}
    h2 { color: var(--color-azul); font-weight: 700;}
    .card-title { color: var(--color-azul-sec); font-weight: 600; }
    .badge {
      font-size: 0.94em;
      border-radius: 7px;
      padding: 5px 15px;
      letter-spacing: 0.5px;
    }
    .badge.bg-secondary {
      background: #e3ecf5 !important;
      color: var(--color-azul) !important;
      border: 1px solid #b6d1ea;
      font-weight: 600;
    }
    .badge.bg-success {
      background: #1b7b5a !important;
      color: #fff !important;
      font-weight: 500;
    }
    .badge.bg-inactivo {
      background: #b2becd !important;
      color: #495466 !important;
      font-weight: 500;
    }
    .btn {
      border-radius: 7px !important;
      font-weight: 500;
      transition: background 0.14s, color 0.14s, border 0.14s;
    }
    .btn-primary {
      background: var(--color-azul) !important;
      border: none !important;
      color: #fff !important;
    }
    .btn-primary:hover { background: #022a47 !important;}
    .btn-outline-secondary {
      border-color: var(--color-azul) !important;
      color: var(--color-azul) !important;
      background: transparent !important;
    }
    .btn-outline-secondary:hover, .btn-outline-secondary:focus {
      background: var(--color-azul) !important;
      color: #fff !important;
    }
    .btn-outline-danger {
      border-color: var(--color-rojo) !important;
      color: var(--color-rojo) !important;
      background: transparent !important;
    }
    .btn-outline-danger:hover {
      background: var(--color-rojo) !important;
      color: #fff !important;
    }
    .btn-outline-dark {
      border-color: var(--color-gris-oscuro) !important;
      color: var(--color-gris-oscuro) !important;
      background: transparent !important;
    }
    .btn-outline-dark:hover {
      background: var(--color-gris-oscuro) !important;
      color: #fff !important;
    }
    .btn-action {
      background: #e3ecf5;
      color: var(--color-azul);
      border: 1px solid #b6d1ea;
    }
    .btn-action:hover {
      background: var(--color-azul);
      color: #fff;
      border: 1px solid var(--color-azul);
    }
    .btn-warning {
      background: #fff7e6 !important;
      color: #b37d14 !important;
      border: 1px solid #ffe0b2 !important;
    }
    .btn-warning:hover {
      background: #ffcc80 !important;
      color: #7f5b0a !important;
      border: 1px solid #ffb300 !important;
    }
    .form-control, .form-select {
      border-radius: 7px !important;
      border-color: var(--color-gris-medio) !important;
    }
    .table th, .table td { vertical-align: middle; border-bottom: 1.5px solid #e9eef5 !important; }
    .table thead { background: #f3f8fc; }
    .table { border-radius: 12px; overflow: hidden;}
    .table-responsive { border-radius: 12px;}
    .d-flex.gap-2 > * { min-width: 112px; }
    @media (max-width: 1000px) {
      .container { max-width: 99vw; }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">üë§ Panel de Administraci√≥n de Usuarios</h2>
    <a href="/" class="btn btn-outline-secondary btn-sm">‚Üê Volver</a>
  </div>

  <!-- Crear usuario -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title">Crear nuevo usuario</h5>
      <form id="crearUsuarioForm" class="row g-3">
        <div class="col-md-4">
          <input type="text" class="form-control" placeholder="Nombre" id="nombre" required />
        </div>
        <div class="col-md-4">
          <input type="email" class="form-control" placeholder="Email" id="email" required />
        </div>
        <div class="col-md-3">
          <select class="form-select" id="rol">
            <option value="usuario">Usuario</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
        <div class="col-md-1 d-grid">
          <button type="submit" class="btn btn-primary">‚ûï</button>
        </div>
      </form>
      <div id="mensaje" class="mt-3"></div>
    </div>
  </div>

  <!-- Lista de usuarios -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Usuarios registrados</h5>
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaUsuarios">
          <!-- Se llenar√° din√°micamente -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  async function cargarUsuarios() {
    const tabla = document.getElementById("tablaUsuarios");
    tabla.innerHTML = "";

    const res = await axios.get("/admin/usuarios");
    res.data.forEach(usuario => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${usuario.nombre}</td>
        <td>${usuario.email}</td>
        <td>
          <span class="badge bg-secondary">${usuario.rol}</span>
        </td>
        <td>
          <span class="badge ${usuario.activo ? 'bg-success' : 'bg-inactivo'}">
            ${usuario.activo ? 'Activo' : 'Inactivo'}
          </span>
        </td>
        <td class="d-flex gap-2">
          <button class="btn btn-sm btn-action" onclick="${usuario.activo
        ? `desactivarUsuario('${usuario.email}')`
        : `activarUsuario('${usuario.email}')`}">
            ${usuario.activo ? '‚õî Desactivar' : 'üü¢ Activar'}
          </button>
          <button class="btn btn-sm btn-outline-dark" onclick="blanquearPassword('${usuario.email}')">üîë Blanquear contrase√±a</button>
          <button class="btn btn-sm btn-outline-danger" onclick="eliminarUsuario('${usuario.email}')">üóëÔ∏è Eliminar</button>
        </td>
      `;
      tabla.appendChild(tr);
    });
  }

  document.getElementById("crearUsuarioForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const nombre = document.getElementById("nombre").value;
    const email = document.getElementById("email").value;
    const rol = document.getElementById("rol").value;

    try {
      const res = await axios.post("/admin/crear-usuario", { nombre, email, rol });
      document.getElementById("mensaje").innerHTML = `<div class="alert alert-success">${res.data.mensaje}</div>`;
      cargarUsuarios();
    } catch (err) {
      document.getElementById("mensaje").innerHTML = `<div class="alert alert-danger">${err.response.data.error}</div>`;
    }
  });

  async function blanquearPassword(email) {
    await axios.post("/admin/blanquear-password", { email });
    alert("Contrase√±a blanqueada a 1234");
  }

  async function desactivarUsuario(email) {
    await axios.post("/admin/desactivar-usuario", { email });
    cargarUsuarios();
  }

  async function activarUsuario(email) {
    await axios.post("/admin/activar-usuario", { email });
    cargarUsuarios();
  }

  async function eliminarUsuario(email) {
    if (confirm("¬øEst√°s seguro de eliminar este usuario?")) {
      await axios.post("/admin/eliminar-usuario", { email });
      cargarUsuarios();
    }
  }

  cargarUsuarios();
</script>
</body>
</html>
