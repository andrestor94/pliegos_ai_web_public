<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Panel de Administraci√≥n</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f8f9fa; }
    .container { max-width: 1000px; margin-top: 40px; }
    .badge { font-size: 0.9em; }
  </style>
</head>
<body>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">üë§ Panel de Administraci√≥n de Usuarios</h2>
    <a href="/" class="btn btn-outline-secondary btn-sm">‚Üê Volver</a>
  </div>

  <!-- Crear usuario -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title">Crear nuevo usuario</h5>
      <form id="crearUsuarioForm" class="row g-3">
        <div class="col-md-4">
          <input type="text" class="form-control" placeholder="Nombre" id="nombre" required />
        </div>
        <div class="col-md-4">
          <input type="email" class="form-control" placeholder="Email" id="email" required />
        </div>
        <div class="col-md-3">
          <select class="form-select" id="rol">
            <option value="usuario">Usuario</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
        <div class="col-md-1 d-grid">
          <button type="submit" class="btn btn-primary">‚ûï</button>
        </div>
      </form>
      <div id="mensaje" class="mt-3"></div>
    </div>
  </div>

  <!-- Lista de usuarios -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Usuarios registrados</h5>
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaUsuarios">
          <!-- Se llenar√° din√°micamente -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  async function cargarUsuarios() {
    const tabla = document.getElementById("tablaUsuarios");
    tabla.innerHTML = "";

    const res = await axios.get("/admin/usuarios");
    res.data.forEach(usuario => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${usuario.nombre}</td>
        <td>${usuario.email}</td>
        <td><span class="badge bg-secondary">${usuario.rol}</span></td>
        <td><span class="badge bg-${usuario.activo ? 'success' : 'secondary'}">${usuario.activo ? 'Activo' : 'Inactivo'}</span></td>
        <td class="d-flex gap-2">
          <button class="btn btn-sm btn-${usuario.activo ? 'warning' : 'success'}" onclick="${usuario.activo
        ? `desactivarUsuario('${usuario.email}')`
        : `activarUsuario('${usuario.email}')`}">
            ${usuario.activo ? '‚õî Desactivar' : 'üü¢ Activar'}
          </button>
          <button class="btn btn-sm btn-warning" onclick="blanquearPassword('${usuario.email}')">üîë Blanquear contrase√±a</button>
          <button class="btn btn-sm btn-outline-danger" onclick="eliminarUsuario('${usuario.email}')">üóëÔ∏è Eliminar</button>
        </td>
      `;
      tabla.appendChild(tr);
    });
  }

  document.getElementById("crearUsuarioForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const nombre = document.getElementById("nombre").value;
    const email = document.getElementById("email").value;
    const rol = document.getElementById("rol").value;

    try {
      const res = await axios.post("/admin/crear-usuario", { nombre, email, rol });
      document.getElementById("mensaje").innerHTML = `<div class="alert alert-success">${res.data.mensaje}</div>`;
      cargarUsuarios();
    } catch (err) {
      document.getElementById("mensaje").innerHTML = `<div class="alert alert-danger">${err.response.data.error}</div>`;
    }
  });

  async function blanquearPassword(email) {
    await axios.post("/admin/blanquear-password", { email });
    alert("Contrase√±a blanqueada a 1234");
  }

  async function desactivarUsuario(email) {
    await axios.post("/admin/desactivar-usuario", { email });
    cargarUsuarios();
  }

  async function activarUsuario(email) {
    await axios.post("/admin/activar-usuario", { email });
    cargarUsuarios();
  }

  async function eliminarUsuario(email) {
    if (confirm("¬øEst√°s seguro de eliminar este usuario?")) {
      await axios.post("/admin/eliminar-usuario", { email });
      cargarUsuarios();
    }
  }

  cargarUsuarios();
</script>
</body>
</html>

