<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historial de AnÃ¡lisis</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
    <style>
        body {
            background-color: #f0f4ff;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 900px;
            margin-top: 40px;
        }
        .historial-box {
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .acciones button {
            margin-right: 10px;
        }
        .navbar {
            background-color: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .logo {
            height: 35px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-light px-4 justify-content-between">
        <div class="d-flex align-items-center">
            <img src="/static/logo-suizo.png" class="logo" alt="Logo Suizo" />
            <span class="navbar-brand mb-0 h1">Suizo Argentina <b>- Licitaciones IA</b></span>
        </div>
        <div>
            <a href="/" class="btn btn-outline-primary btn-sm">Volver al inicio</a>
        </div>
    </nav>

    <div class="container">
        <h2 class="my-4">ðŸ“š Historial de AnÃ¡lisis</h2>

        <input type="text" id="busqueda" class="form-control mb-4" placeholder="Buscar en el historial..." onkeyup="filtrar()">

        <div id="contenedor-historial">
            {% for item in historial %}
            <div class="historial-box">
                <p><strong>ðŸ“„ Archivo:</strong> {{ item.nombre_archivo }}</p>
                <p><strong>ðŸ•“ Fecha:</strong> {{ item.fecha_legible }}</p>
                <p><strong>ðŸ‘¤ Usuario:</strong> {{ item.usuario }}</p>
                <div class="acciones mt-3">
                    <a href="/descargar/{{ item.nombre_archivo }}" class="btn btn-sm btn-success">Descargar PDF</a>
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminar('{{ item.timestamp }}')">Eliminar</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function eliminar(timestamp) {
            if (!confirm("Â¿Seguro que deseas eliminar este anÃ¡lisis?")) return;
            fetch(`/eliminar/${timestamp}`, { method: 'DELETE' })
                .then(() => location.reload());
        }

        function filtrar() {
            let texto = document.getElementById("busqueda").value.toLowerCase();
            let historial = document.querySelectorAll(".historial-box");
            historial.forEach(box => {
                let contenido = box.innerText.toLowerCase();
                box.style.display = contenido.includes(texto) ? "block" : "none";
            });
        }
    </script>
</body>
</html>
